<div id="content" class="col-md-9 admin">
	
  <h2><%=t('revs.user.curator_dashboard')%></h2>

  <h3>
    <%= t('revs.curator.annotations') %>
    <span class="object-count muted">(<%= Annotation.count %> <%=t('revs.messages.total')%>)</span>
  </h3>
  
  <ul class="nav nav-tabs">
      <li class="<%="active" if @tab == @tab_list_item%>"><a href="#annotations-grouped" data-toggle="tab"><%=t('revs.curator.by_item') %></a></li>
      <li class="<%="active" if @tab == @tab_list_all%>"><a href="#annotations-list" data-toggle="tab"><%= t('revs.curator.by_annotation') %></a></li>
      <li class="<%="active" if @tab == @tab_list_user%>"><a href="#annotations-user" data-toggle="tab"><%= t('revs.curator.by_user') %></a></li>
  </ul>

  <div class="tab-content">

<%# -- Tab: Annotations Grouped By Item -- %>
    <div id='annotations-grouped' class="tab-pane <%="active" if @tab == @tab_list_item%>">

      <div class="saved-item-pagination">
        <span>
          <%= page_entries_info @annotations_by_item, :entry_name=>t('revs.user_galleries.item') %>
        </span>
      </div>

      <table class="table table-bordered table-condensed table-hover table-striped">
        <tr>
          <th><%= t('revs.curator.item_title') %></th>
          <th class="right"><%= link_to t('revs.curator.annotations_made'), annotations_table_curator_tasks_path(:order_by_item=>'num_annotations DESC',  :tab=>@tab_list_item) %></th>
          <th><%=link_to t('revs.curator.last_updated'), annotations_table_curator_tasks_path(:order_by_item=>'updated_at desc', :tab=>@tab_list_item  )%></th>
        </tr>

        <% @annotations_by_item.each do |annotation| %>
          <tr>
            <td><%=item_link(annotation.solr_document,:truncate=>true)%></td>
            <td class="right"><%= annotation.num_annotations%></td>
            <td><%= show_as_date(annotation.updated_at.in_time_zone)%></td>
          </tr>
        <% end %>
      </table>

      <%= paginate @annotations_by_item,:param_name => :pagina,  :params => {:order=>@order_by_item, :tab=>@tab_list_item} %>
    </div>

<%# -- Tab: Annotations Shown By Annotation -- %>
    <div id='annotations-list' class="tab-pane <%="active" if @tab == @tab_list_all%>">

      <div class="saved-item-pagination">
        <span>
          <%= page_entries_info @annotations_list, :entry_name=>'annotations' %>
        </span>
      </div>

      <table class="table table-bordered table-condensed table-hover table-striped">
        <tr>
          <th><%= t('revs.curator.item_title') %></th>
          <th><%=t('revs.annotations.annotation_text')%></th>
          <th><%=link_to t('revs.curator.username'), annotations_table_curator_tasks_path(:order_all=>'user_id', :tab=>@tab_list_all)%></th>
          <th><%=link_to t('revs.curator.created_on'), annotations_table_curator_tasks_path(:order_all=>'created_at desc', :tab=>@tab_list_all  )%></th>
        </tr>
        <%@annotations_list.each do |annotation| %>
          <tr>
            <td><%=item_link(annotation.solr_document,:truncate=>true)%></td>
            <td><%= annotation.text%></td>
            <td><%= display_user_name(annotation.user,user_annotations_user_index_path(annotation.user.username))%></td>
            <td><%= show_as_datetime(annotation.created_at.in_time_zone)%></td>
          </tr>
        <% end %>
      </table>

      <%= paginate @annotations_list,:param_name => :pagina2,  :params => {:order_all=>@order_all, :tab=>@tab_list_all} %>
    </div>

<%# -- Tab: Annotations Grouped By User -- %>
    <div id='annotations-user' class="tab-pane <%="active" if @tab == @tab_list_user%>">

      <div class="saved-item-pagination">
        <span>
          <%= page_entries_info @annotations_by_user, :entry_name=>'user' %>
        </span>
      </div>

      <table class="table table-bordered table-condensed table-hover table-striped">
        <tr>
          <th><%=link_to t('revs.curator.username'), annotations_table_curator_tasks_path(:order_user=>'user_id', :tab=>@tab_list_user) %></th>
          <th class="right"><%=link_to t('revs.curator.annotations_made'), annotations_table_curator_tasks_path(:order_user=>'num_annotations DESC', :tab=>@tab_list_user) %></th>
          <th><%=link_to t('revs.curator.last_annotation'), annotations_table_curator_tasks_path(:order_user=>'updated_at desc', :tab=>@tab_list_user  )%></th>
        </tr>
        <% @annotations_by_user.each do |result| %>
          <tr>
            <td><%=display_user_name(result.user,user_annotations_user_index_path(result.user.username))%></td>
            <td class="right"><%= result.num_annotations%></td>
            <td><%= show_as_date(result.updated_at.in_time_zone)%></td>
          </tr>
        <% end %>
      </table>

      <%= paginate @annotations_by_user, :param_name => :pagina3, :params => {:order_user=>@order_user, :tab=>@tab_list_user} %>
   </div>

  </div>
   

</div>

<%= render :partial => 'devise/shared/show_curator_sidebar' %>
